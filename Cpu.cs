static partial class Cpu {
    delegate void InstructionDelegate();
    static readonly ushort RESET_VECTOR = 0x0100;
    static readonly ushort STACK_VECTOR = 0xFFFE;
    static readonly ushort AF_BOOT      = 0x01B0;
    static readonly ushort BC_BOOT      = 0x0013;
    static readonly ushort DE_BOOT      = 0x00D8;
    static readonly ushort HL_BOOT      = 0x014D;
    static ushort PC;
    static ushort SP;
    static Register AF = new Register();
    static Register BC = new Register();
    static Register DE = new Register();
    static Register HL = new Register();
    static byte[] Rom = [];

    private static List<InstructionDelegate> Instructions = new List<InstructionDelegate>();

    public static void SetRom(byte[] rom) {
        Rom = rom;
    }

    public static void Run() {
        while(true) {
            byte instruction = ReadAndIncPc8Bit();
            Instructions[instruction]();
        }
    } 

    static byte ReadAndIncPc8Bit() {
        byte val = Rom[PC];
        PC+=1;
        return val;
    }

    static Cpu() {
        PC = RESET_VECTOR;
        SP = STACK_VECTOR;
        AF.HL = AF_BOOT;
        BC.HL = BC_BOOT;
        DE.HL = DE_BOOT;
        HL.HL = HL_BOOT;

        Instructions[0x00] = Op0x00;
        Instructions[0x01] = Op0x01;
        Instructions[0x02] = Op0x02;
        Instructions[0x03] = Op0x03;
        Instructions[0x04] = Op0x04;
        Instructions[0x05] = Op0x05;
        Instructions[0x06] = Op0x06;
        Instructions[0x07] = Op0x07;
        Instructions[0x08] = Op0x08;
        Instructions[0x09] = Op0x09;
        Instructions[0x0A] = Op0x0A;
        Instructions[0x0B] = Op0x0B;
        Instructions[0x0C] = Op0x0C;
        Instructions[0x0D] = Op0x0D;
        Instructions[0x0E] = Op0x0E;
        Instructions[0x0F] = Op0x0F;
        Instructions[0x10] = Op0x10;
        Instructions[0x11] = Op0x11;
        Instructions[0x12] = Op0x12;
        Instructions[0x13] = Op0x13;
        Instructions[0x14] = Op0x14;
        Instructions[0x15] = Op0x15;
        Instructions[0x16] = Op0x16;
        Instructions[0x17] = Op0x17;
        Instructions[0x18] = Op0x18;
        Instructions[0x19] = Op0x19;
        Instructions[0x1A] = Op0x1A;
        Instructions[0x1B] = Op0x1B;
        Instructions[0x1C] = Op0x1C;
        Instructions[0x1D] = Op0x1D;
        Instructions[0x1E] = Op0x1E;
        Instructions[0x1F] = Op0x1F;
        Instructions[0x20] = Op0x20;
        Instructions[0x21] = Op0x21;
        Instructions[0x22] = Op0x22;
        Instructions[0x23] = Op0x23;
        Instructions[0x24] = Op0x24;
        Instructions[0x25] = Op0x25;
        Instructions[0x26] = Op0x26;
        Instructions[0x27] = Op0x27;
        Instructions[0x28] = Op0x28;
        Instructions[0x29] = Op0x29;
        Instructions[0x2A] = Op0x2A;
        Instructions[0x2B] = Op0x2B;
        Instructions[0x2C] = Op0x2C;
        Instructions[0x2D] = Op0x2D;
        Instructions[0x2E] = Op0x2E;
        Instructions[0x2F] = Op0x2F;
        Instructions[0x30] = Op0x30;
        Instructions[0x31] = Op0x31;
        Instructions[0x32] = Op0x32;
        Instructions[0x33] = Op0x33;
        Instructions[0x34] = Op0x34;
        Instructions[0x35] = Op0x35;
        Instructions[0x36] = Op0x36;
        Instructions[0x37] = Op0x37;
        Instructions[0x38] = Op0x38;
        Instructions[0x39] = Op0x39;
        Instructions[0x3A] = Op0x3A;
        Instructions[0x3B] = Op0x3B;
        Instructions[0x3C] = Op0x3C;
        Instructions[0x3D] = Op0x3D;
        Instructions[0x3E] = Op0x3E;
        Instructions[0x3F] = Op0x3F;
        Instructions[0x40] = Op0x40;
        Instructions[0x41] = Op0x41;
        Instructions[0x42] = Op0x42;
        Instructions[0x43] = Op0x43;
        Instructions[0x44] = Op0x44;
        Instructions[0x45] = Op0x45;
        Instructions[0x46] = Op0x46;
        Instructions[0x47] = Op0x47;
        Instructions[0x48] = Op0x48;
        Instructions[0x49] = Op0x49;
        Instructions[0x4A] = Op0x4A;
        Instructions[0x4B] = Op0x4B;
        Instructions[0x4C] = Op0x4C;
        Instructions[0x4D] = Op0x4D;
        Instructions[0x4E] = Op0x4E;
        Instructions[0x4F] = Op0x4F;
        Instructions[0x50] = Op0x50;
        Instructions[0x51] = Op0x51;
        Instructions[0x52] = Op0x52;
        Instructions[0x53] = Op0x53;
        Instructions[0x54] = Op0x54;
        Instructions[0x55] = Op0x55;
        Instructions[0x56] = Op0x56;
        Instructions[0x57] = Op0x57;
        Instructions[0x58] = Op0x58;
        Instructions[0x59] = Op0x59;
        Instructions[0x5A] = Op0x5A;
        Instructions[0x5B] = Op0x5B;
        Instructions[0x5C] = Op0x5C;
        Instructions[0x5D] = Op0x5D;
        Instructions[0x5E] = Op0x5E;
        Instructions[0x5F] = Op0x5F;
        Instructions[0x60] = Op0x60;
        Instructions[0x61] = Op0x61;
        Instructions[0x62] = Op0x62;
        Instructions[0x63] = Op0x63;
        Instructions[0x64] = Op0x64;
        Instructions[0x65] = Op0x65;
        Instructions[0x66] = Op0x66;
        Instructions[0x67] = Op0x67;
        Instructions[0x68] = Op0x68;
        Instructions[0x69] = Op0x69;
        Instructions[0x6A] = Op0x6A;
        Instructions[0x6B] = Op0x6B;
        Instructions[0x6C] = Op0x6C;
        Instructions[0x6D] = Op0x6D;
        Instructions[0x6E] = Op0x6E;
        Instructions[0x6F] = Op0x6F;
        Instructions[0x70] = Op0x70;
        Instructions[0x71] = Op0x71;
        Instructions[0x72] = Op0x72;
        Instructions[0x73] = Op0x73;
        Instructions[0x74] = Op0x74;
        Instructions[0x75] = Op0x75;
        Instructions[0x76] = Op0x76;
        Instructions[0x77] = Op0x77;
        Instructions[0x78] = Op0x78;
        Instructions[0x79] = Op0x79;
        Instructions[0x7A] = Op0x7A;
        Instructions[0x7B] = Op0x7B;
        Instructions[0x7C] = Op0x7C;
        Instructions[0x7D] = Op0x7D;
        Instructions[0x7E] = Op0x7E;
        Instructions[0x7F] = Op0x7F;
        Instructions[0x80] = Op0x80;
        Instructions[0x81] = Op0x81;
        Instructions[0x82] = Op0x82;
        Instructions[0x83] = Op0x83;
        Instructions[0x84] = Op0x84;
        Instructions[0x85] = Op0x85;
        Instructions[0x86] = Op0x86;
        Instructions[0x87] = Op0x87;
        Instructions[0x88] = Op0x88;
        Instructions[0x89] = Op0x89;
        Instructions[0x8A] = Op0x8A;
        Instructions[0x8B] = Op0x8B;
        Instructions[0x8C] = Op0x8C;
        Instructions[0x8D] = Op0x8D;
        Instructions[0x8E] = Op0x8E;
        Instructions[0x8F] = Op0x8F;
        Instructions[0x90] = Op0x90;
        Instructions[0x91] = Op0x91;
        Instructions[0x92] = Op0x92;
        Instructions[0x93] = Op0x93;
        Instructions[0x94] = Op0x94;
        Instructions[0x95] = Op0x95;
        Instructions[0x96] = Op0x96;
        Instructions[0x97] = Op0x97;
        Instructions[0x98] = Op0x98;
        Instructions[0x99] = Op0x99;
        Instructions[0x9A] = Op0x9A;
        Instructions[0x9B] = Op0x9B;
        Instructions[0x9C] = Op0x9C;
        Instructions[0x9D] = Op0x9D;
        Instructions[0x9E] = Op0x9E;
        Instructions[0x9F] = Op0x9F;
        Instructions[0xA0] = Op0xA0;
        Instructions[0xA1] = Op0xA1;
        Instructions[0xA2] = Op0xA2;
        Instructions[0xA3] = Op0xA3;
        Instructions[0xA4] = Op0xA4;
        Instructions[0xA5] = Op0xA5;
        Instructions[0xA6] = Op0xA6;
        Instructions[0xA7] = Op0xA7;
        Instructions[0xA8] = Op0xA8;
        Instructions[0xA9] = Op0xA9;
        Instructions[0xAA] = Op0xAA;
        Instructions[0xAB] = Op0xAB;
        Instructions[0xAC] = Op0xAC;
        Instructions[0xAD] = Op0xAD;
        Instructions[0xAE] = Op0xAE;
        Instructions[0xAF] = Op0xAF;
        Instructions[0xB0] = Op0xB0;
        Instructions[0xB1] = Op0xB1;
        Instructions[0xB2] = Op0xB2;
        Instructions[0xB3] = Op0xB3;
        Instructions[0xB4] = Op0xB4;
        Instructions[0xB5] = Op0xB5;
        Instructions[0xB6] = Op0xB6;
        Instructions[0xB7] = Op0xB7;
        Instructions[0xB8] = Op0xB8;
        Instructions[0xB9] = Op0xB9;
        Instructions[0xBA] = Op0xBA;
        Instructions[0xBB] = Op0xBB;
        Instructions[0xBC] = Op0xBC;
        Instructions[0xBD] = Op0xBD;
        Instructions[0xBE] = Op0xBE;
        Instructions[0xBF] = Op0xBF;
        Instructions[0xC0] = Op0xC0;
        Instructions[0xC1] = Op0xC1;
        Instructions[0xC2] = Op0xC2;
        Instructions[0xC3] = Op0xC3;
        Instructions[0xC4] = Op0xC4;
        Instructions[0xC5] = Op0xC5;
        Instructions[0xC6] = Op0xC6;
        Instructions[0xC7] = Op0xC7;
        Instructions[0xC8] = Op0xC8;
        Instructions[0xC9] = Op0xC9;
        Instructions[0xCA] = Op0xCA;
        Instructions[0xCB] = Op0xCB;
        Instructions[0xCC] = Op0xCC;
        Instructions[0xCD] = Op0xCD;
        Instructions[0xCE] = Op0xCE;
        Instructions[0xCF] = Op0xCF;
        Instructions[0xD0] = Op0xD0;
        Instructions[0xD1] = Op0xD1;
        Instructions[0xD2] = Op0xD2;
        Instructions[0xD3] = Op0xD3;
        Instructions[0xD4] = Op0xD4;
        Instructions[0xD5] = Op0xD5;
        Instructions[0xD6] = Op0xD6;
        Instructions[0xD7] = Op0xD7;
        Instructions[0xD8] = Op0xD8;
        Instructions[0xD9] = Op0xD9;
        Instructions[0xDA] = Op0xDA;
        Instructions[0xDB] = Op0xDB;
        Instructions[0xDC] = Op0xDC;
        Instructions[0xDD] = Op0xDD;
        Instructions[0xDE] = Op0xDE;
        Instructions[0xDF] = Op0xDF;
        Instructions[0xE0] = Op0xE0;
        Instructions[0xE1] = Op0xE1;
        Instructions[0xE2] = Op0xE2;
        Instructions[0xE3] = Op0xE3;
        Instructions[0xE4] = Op0xE4;
        Instructions[0xE5] = Op0xE5;
        Instructions[0xE6] = Op0xE6;
        Instructions[0xE7] = Op0xE7;
        Instructions[0xE8] = Op0xE8;
        Instructions[0xE9] = Op0xE9;
        Instructions[0xEA] = Op0xEA;
        Instructions[0xEB] = Op0xEB;
        Instructions[0xEC] = Op0xEC;
        Instructions[0xED] = Op0xED;
        Instructions[0xEE] = Op0xEE;
        Instructions[0xEF] = Op0xEF;
        Instructions[0xF0] = Op0xF0;
        Instructions[0xF1] = Op0xF1;
        Instructions[0xF2] = Op0xF2;
        Instructions[0xF3] = Op0xF3;
        Instructions[0xF4] = Op0xF4;
        Instructions[0xF5] = Op0xF5;
        Instructions[0xF6] = Op0xF6;
        Instructions[0xF7] = Op0xF7;
        Instructions[0xF8] = Op0xF8;
        Instructions[0xF9] = Op0xF9;
        Instructions[0xFA] = Op0xFA;
        Instructions[0xFB] = Op0xFB;
        Instructions[0xFC] = Op0xFC;
        Instructions[0xFD] = Op0xFD;
        Instructions[0xFE] = Op0xFE;
        Instructions[0xFF] = Op0xFF;
    }
}